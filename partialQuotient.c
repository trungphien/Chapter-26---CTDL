#include<stdlib.h>
#include<gmp.h>
#define mpf_for(buf, op, n)\
    do {\
        size_t i;\
        for (i = 0; i < (n); ++i)\
            mpf_##op(buf[i]);\
    } while (0)
#define n 10000
int main()
{
    mpf_set_default_prec(5200);
    mpf_t *a = malloc(sizeof(mpf_t) * (n + 1));
    mpf_for(a, init, n + 1);

    mpf_t s, r, S, R, y, temp, temp1, luythua;
    mpf_inits(s, r, S, R, y, temp, temp1, luythua, NULL);
    mpf_set_ui(luythua, 10);
    mpf_pow_ui(luythua, luythua, 1500);

    mpf_set_str(y, "0.577215664901532860606512090082402431042159335939923598805767234884867726777664670936947063291746749514631447249807082480960504014486542836224173997644923536253500333742937337737673942792595258247094916008735203948165670853233151776611528621199501507984793745085705740029921354786146694029604325421519058775535267331399254012967420513754139549111685102807984234877587205038431093997361372553060889331267600172479537836759271351577226102734929139407984301034177717780881549570661075010161916633401522789358679654972520362128792265559536696281763887927268013243101047650596370394739495763890657296792960100901512519595092224350140934987122824794974719564697631850667612906381105182419744486783638086174945516989279230187739107294578155431600500218284409605377243420328547836701517739439870030237033951832869000155819398804270741154222781971652301107356583396734871765049194181230004065469314299929777956930310050308630341856980323108369164002589297089098548682577736428825395492587362959613329857473930237343884707037028441292016641785024873337908056275499843459076164316710314671072237002181074504441866475913480366902553245862544222534518138791243457350136129778227828814894590986384600629316947188714958752549236649352047324364109726827616087759508809512620840454447799227398311287170053980800551334671749415291225069827518032439513038040960525555206988539507148900661388256400109666971260047379260179940647805582637146056780845039061966857603532901945531090838461839111504056376621764143634533815270745423053446970405654307619774994727049428331612304263907283494355360789", 10);
    mpf_set_str(r, "0.577215664901532860606512090082402431042159335939923598805767234884867726777664670936947063291746749514631447249807082480960504014486542836224173997644923536253500333742937337737673942792595258247094916008735203948165670853233151776611528621199501507984793745085705740029921354786146694029604325421519058775535267331399254012967420513754139549111685102807984234877587205038431093997361372553060889331267600172479537836759271351577226102734929139407984301034177717780881549570661075010161916633401522789358679654972520362128792265559536696281763887927268013243101047650596370394739495763890657296792960100901512519595092224350140934987122824794974719564697631850667612906381105182419744486783638086174945516989279230187739107294578155431600500218284409605377243420328547836701517739439870030237033951832869000155819398804270741154222781971652301107356583396734871765049194181230004065469314299929777956930310050308630341856980323108369164002589297089098548682577736428825395492587362959613329857473930237343884707037028441292016641785024873337908056275499843459076164316710314671072237002181074504441866475913480366902553245862544222534518138791243457350136129778227828814894590986384600629316947188714958752549236649352047324364109726827616087759508809512620840454447799227398311287170053980800551334671749415291225069827518032439513038040960525555206988539507148900661388256400109666971260047379260179940647805582637146056780845039061966857603532901945531090838461839111504056376621764143634533815270745423053446970405654307619774994727049428331612304263907283494355360788", 10);
    mpf_set_str(s, "0.577215664901532860606512090082402431042159335939923598805767234884867726777664670936947063291746749514631447249807082480960504014486542836224173997644923536253500333742937337737673942792595258247094916008735203948165670853233151776611528621199501507984793745085705740029921354786146694029604325421519058775535267331399254012967420513754139549111685102807984234877587205038431093997361372553060889331267600172479537836759271351577226102734929139407984301034177717780881549570661075010161916633401522789358679654972520362128792265559536696281763887927268013243101047650596370394739495763890657296792960100901512519595092224350140934987122824794974719564697631850667612906381105182419744486783638086174945516989279230187739107294578155431600500218284409605377243420328547836701517739439870030237033951832869000155819398804270741154222781971652301107356583396734871765049194181230004065469314299929777956930310050308630341856980323108369164002589297089098548682577736428825395492587362959613329857473930237343884707037028441292016641785024873337908056275499843459076164316710314671072237002181074504441866475913480366902553245862544222534518138791243457350136129778227828814894590986384600629316947188714958752549236649352047324364109726827616087759508809512620840454447799227398311287170053980800551334671749415291225069827518032439513038040960525555206988539507148900661388256400109666971260047379260179940647805582637146056780845039061966857603532901945531090838461839111504056376621764143634533815270745423053446970405654307619774994727049428331612304263907283494355360790", 10);
    // r <= y <= s

    mpf_trunc(S, s);
    mpf_trunc(R, r);

    unsigned int i=0;
    while(mpf_cmp(S, R) == 0)
    {
        // a[i] = [y];
        mpf_trunc(a[i], y);
        mpf_sub(y, y, a[i]);
        mpf_ui_div(y, 1, y);

        mpf_sub(s, s, S); // s = {s}^-1
        mpf_sub(r, r, R); // r = {r}^-1

        mpf_ui_div(temp, 1, s);
        mpf_ui_div(temp1, 1, r);

        mpf_mul(temp, temp, luythua);
        mpf_trunc(temp, temp); // cat bot con lai 1500 chu so thap phan
        mpf_div(temp, temp, luythua);

        mpf_mul(temp1, temp1, luythua);
        mpf_ceil(temp1, temp1); // lam tron len den 1500 chu so thap phan
        mpf_div(temp1, temp1, luythua);

        mpf_set(r, temp);
        mpf_set(s, temp1);
        mpf_trunc(S, s);
        mpf_trunc(R, r);

        i++;
    }

    unsigned int j;
    printf("%u thuong so tung phan xac dinh duoc la: \n", i);
    printf(" ");
    for(j = 0; j<14; j++)
    {
         gmp_printf("%.Ff ", a[j]);
    }
    for(j=14; j<i; j++)
    {
        if(j%15 == 14)
        {
            gmp_printf("\n");
        }
        gmp_printf("%.Ff ", a[j]);
    }
    mpf_clears(s, r, S, R, y, temp, temp1, luythua, NULL);
    mpf_for(a, clear, n + 1);
    free(a);
}
